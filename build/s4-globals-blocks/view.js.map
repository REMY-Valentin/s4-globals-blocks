{"version":3,"file":"s4-globals-blocks/view.js","mappings":"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","sources":["webpack://s4-globals-blocks/./src/s4-globals-blocks/view.js"],"sourcesContent":["// view.js - Compatible avec wp-env\r\n(function() {\r\n    // Counter to limit retries\r\n    let retryCount = 0;\r\n    const maxRetries = 20; // Max number of retries (2 seconds total with 100ms intervals)\r\n    \r\n    // Store carousel configurations for change detection\r\n    let carouselConfigs = {};\r\n    \r\n    // Log all script tags to help with debugging\r\n    console.log('=== S4 Carousel Debugging ===');\r\n    console.log('Document readyState:', document.readyState);\r\n    console.log('Checking loaded scripts:');\r\n    const scripts = document.getElementsByTagName('script');\r\n    for (let i = 0; i < scripts.length; i++) {\r\n        const src = scripts[i].src || '(inline script)';\r\n        console.log(`Script ${i+1}:`, src);\r\n        if (src.includes('jquery')) {\r\n            console.log('  jQuery script found:', src);\r\n        }\r\n        if (src.includes('owl') || src.includes('carousel')) {\r\n            console.log('  Owl Carousel script found:', src);\r\n        }\r\n    }\r\n    \r\n    // Log loaded CSS files\r\n    console.log('Checking loaded CSS:');\r\n    const styleSheets = document.styleSheets;\r\n    for (let i = 0; i < styleSheets.length; i++) {\r\n        try {\r\n            const href = styleSheets[i].href || '(inline style)';\r\n            console.log(`CSS ${i+1}:`, href);\r\n            if (href.includes('owl') || href.includes('carousel')) {\r\n                console.log('  Owl Carousel CSS found:', href);\r\n            }\r\n        } catch (e) {\r\n            console.log(`CSS ${i+1}: (blocked by CORS policy)`);\r\n        }\r\n    }\r\n    \r\n    // Function to destroy and reinitialize a specific carousel\r\n    function reinitializeCarousel($, $carousel) {\r\n        const carouselId = $carousel.attr('id');\r\n        console.log(`Reinitializing carousel (ID: ${carouselId})`);\r\n        \r\n        try {\r\n            // Get current options before destroying\r\n            const optionsString = $carousel.attr('data-carousel-options');\r\n            let options = {};\r\n            \r\n            try {\r\n                if (optionsString) {\r\n                    options = JSON.parse(optionsString);\r\n                }\r\n            } catch (e) {\r\n                console.error('Error parsing carousel options:', e);\r\n            }\r\n            \r\n            // Destroy the carousel instance\r\n            $carousel.trigger('destroy.owl.carousel');\r\n            \r\n            // Remove all Owl Carousel classes and styles\r\n            $carousel.removeClass('owl-loaded owl-drag');\r\n            $carousel.find('.owl-stage-outer, .owl-stage, .owl-item, .owl-nav, .owl-dots, .owl-dot').remove();\r\n            \r\n            // Reset the original structure\r\n            $carousel.find('.item').css({\r\n                'width': '',\r\n                'position': '',\r\n                'display': ''\r\n            });\r\n            \r\n            // Initialize with the new options\r\n            $carousel.owlCarousel(options);\r\n            console.log(`Carousel (ID: ${carouselId}) reinitialized successfully`);\r\n            \r\n            // Apply overflow style after reinitialization\r\n            const stageOuter = $carousel.find('.owl-stage-outer');\r\n            if (stageOuter.length) {\r\n                const overflowSetting = $carousel.attr('data-overflow-hidden') === 'true' ? 'hidden' : 'visible';\r\n                stageOuter.css('overflow', overflowSetting);\r\n            }\r\n        } catch (error) {\r\n            console.error(`Error reinitializing carousel (ID: ${carouselId}):`, error);\r\n        }\r\n    }\r\n    \r\n    // Check if carousel configuration has changed\r\n    function hasConfigChanged($carousel) {\r\n        const carouselId = $carousel.attr('id');\r\n        const currentConfig = $carousel.attr('data-carousel-options');\r\n        const navStyle = $carousel.attr('data-nav-style');\r\n        \r\n        // Create a config key that includes both options and nav style\r\n        const configKey = `${currentConfig}_${navStyle}`;\r\n        \r\n        // If we don't have a stored config for this carousel, store it and return false\r\n        if (!carouselConfigs[carouselId]) {\r\n            carouselConfigs[carouselId] = configKey;\r\n            return false;\r\n        }\r\n        \r\n        // Check if the config has changed\r\n        const hasChanged = carouselConfigs[carouselId] !== configKey;\r\n        \r\n        // Update the stored config if it changed\r\n        if (hasChanged) {\r\n            console.log(`Detected change in carousel config for ID: ${carouselId}`);\r\n            carouselConfigs[carouselId] = configKey;\r\n        }\r\n        \r\n        return hasChanged;\r\n    }\r\n    \r\n    // Attendre que jQuery soit complètement chargé et disponible\r\n    function initCarousel() {\r\n        if (typeof jQuery === 'undefined') {\r\n            console.log('jQuery not loaded yet, retrying... attempt ' + (retryCount + 1));\r\n            if (retryCount < maxRetries) {\r\n                retryCount++;\r\n                setTimeout(initCarousel, 100);\r\n            } else {\r\n                console.error('Failed to load jQuery after multiple attempts');\r\n            }\r\n            return;\r\n        }\r\n        \r\n        jQuery(document).ready(function($) {\r\n            console.log('jQuery is loaded, initializing carousel');\r\n            \r\n            // Check DOM for carousel elements\r\n            const carousels = $('.s4_block_carousel.owl-carousel');\r\n            console.log('DOM elements with class .s4_block_carousel.owl-carousel:', carousels.length);\r\n            \r\n            if (carousels.length === 0) {\r\n                console.warn('No .s4_block_carousel.owl-carousel elements found on page');\r\n                // Try with just the main class as fallback\r\n                const mainCarousels = $('.s4_block_carousel');\r\n                console.log('DOM elements with class .s4_block_carousel:', mainCarousels.length);\r\n                \r\n                if (mainCarousels.length > 0) {\r\n                    console.log('Found carousel elements with main class only');\r\n                }\r\n                return;\r\n            } else {\r\n                console.log('Found ' + carousels.length + ' carousel(s) on page');\r\n            }\r\n            \r\n            // Check if Owl Carousel is loaded\r\n            if (typeof $.fn.owlCarousel === 'undefined') {\r\n                console.error('Owl Carousel plugin not loaded. Check if the script is included correctly.');\r\n                \r\n                // Try to load it manually as a fallback (not recommended for production)\r\n                const scriptPath = '/wp-content/plugins/s4-globals-blocks/assets/owl.carousel.min.js';\r\n                console.log('Attempting to load Owl Carousel from: ' + scriptPath);\r\n                \r\n                const script = document.createElement('script');\r\n                script.src = scriptPath;\r\n                script.onload = function() {\r\n                    console.log('Owl Carousel loaded manually, initializing carousels');\r\n                    initOwlCarousels($);\r\n                };\r\n                script.onerror = function() {\r\n                    console.error('Failed to load Owl Carousel manually');\r\n                };\r\n                document.head.appendChild(script);\r\n                \r\n                return;\r\n            }\r\n            \r\n            // Initialize carousels\r\n            initOwlCarousels($);\r\n            \r\n            // Set up MutationObserver to watch for attribute changes\r\n            setupMutationObserver($);\r\n        });\r\n    }\r\n    \r\n    // Set up MutationObserver to detect changes to the carousel\r\n    function setupMutationObserver($) {\r\n        if (!window.MutationObserver) {\r\n            console.log('MutationObserver not supported in this browser');\r\n            return;\r\n        }\r\n        \r\n        // Create a new observer for each carousel\r\n        $('.s4_block_carousel.owl-carousel').each(function() {\r\n            const $carousel = $(this);\r\n            const carouselId = $carousel.attr('id');\r\n            \r\n            const observer = new MutationObserver(function(mutations) {\r\n                let needsReinit = false;\r\n                \r\n                mutations.forEach(function(mutation) {\r\n                    if (mutation.type === 'attributes' && \r\n                       (mutation.attributeName === 'data-carousel-options' || \r\n                        mutation.attributeName === 'data-nav-style')) {\r\n                        needsReinit = true;\r\n                    }\r\n                });\r\n                \r\n                if (needsReinit) {\r\n                    console.log(`Mutation detected for carousel ID: ${carouselId}, reinitializing...`);\r\n                    reinitializeCarousel($, $carousel);\r\n                }\r\n            });\r\n            \r\n            // Options for the observer (which mutations to observe)\r\n            const config = { attributes: true, attributeFilter: ['data-carousel-options', 'data-nav-style'] };\r\n            \r\n            // Start observing the carousel element\r\n            observer.observe($carousel[0], config);\r\n            console.log(`Mutation observer set up for carousel ID: ${carouselId}`);\r\n        });\r\n    }\r\n    \r\n    // Extract carousel initialization to a separate function\r\n    function initOwlCarousels($) {\r\n        // Initialize each carousel with its own options\r\n        $('.s4_block_carousel.owl-carousel').each(function(index) {\r\n            const $carousel = $(this);\r\n            const carouselId = $carousel.attr('id') || 'carousel-' + index;\r\n            console.log(`Initializing carousel #${index + 1} (ID: ${carouselId})`);\r\n            \r\n            try {\r\n                // If already initialized, check if config has changed\r\n                if ($carousel.hasClass('owl-loaded')) {\r\n                    if (hasConfigChanged($carousel)) {\r\n                        console.log(`Config changed for carousel #${index + 1} (ID: ${carouselId}), reinitializing`);\r\n                        reinitializeCarousel($, $carousel);\r\n                    } else {\r\n                        console.log(`Carousel #${index + 1} already initialized, skipping`);\r\n                    }\r\n                    return;\r\n                }\r\n                \r\n                const optionsString = $carousel.attr('data-carousel-options');\r\n                let options = {};\r\n                \r\n                try {\r\n                    if (optionsString) {\r\n                        options = JSON.parse(optionsString);\r\n                        console.log('Carousel options:', options);\r\n                        \r\n                        // Store initial config for change detection\r\n                        const navStyle = $carousel.attr('data-nav-style');\r\n                        carouselConfigs[carouselId] = `${optionsString}_${navStyle}`;\r\n                    } else {\r\n                        console.warn('No carousel options found, using defaults');\r\n                    }\r\n                } catch (e) {\r\n                    console.error('Error parsing carousel options:', e);\r\n                }\r\n                \r\n                // Default options as fallback\r\n                const defaultOptions = {\r\n                    items: 1,\r\n                    loop: true,\r\n                    margin: 10,\r\n                    nav: true,\r\n                    dots: true,\r\n                    autoplay: true,\r\n                    autoplayTimeout: 5000,\r\n                    autoplayHoverPause: true,\r\n                    mouseDrag: true,\r\n                    pullDrag: true,\r\n                    freeDrag: false,\r\n                    touchDrag: true,\r\n                    smartSpeed: 500,\r\n                    responsive: {\r\n                        0: {\r\n                            items: 1,\r\n                            nav: options.nav\r\n                        },\r\n                        600: {\r\n                            items: 2,\r\n                            nav: options.nav\r\n                        },\r\n                        1000: {\r\n                            items: 3,\r\n                            nav: options.nav\r\n                        }\r\n                    }\r\n                };\r\n           \r\n                // Merge default options with saved options\r\n                const carouselOptions = { ...defaultOptions, ...options };\r\n                \r\n                // Initialize the carousel with the merged options\r\n                $carousel.owlCarousel(carouselOptions);\r\n                console.log(`Carousel #${index + 1} (ID: ${carouselId}) initialized successfully`);\r\n                \r\n                // Apply overflow style after initialization\r\n                const stageOuter = $carousel.find('.owl-stage-outer');\r\n                if (stageOuter.length) {\r\n                    const overflowSetting = $carousel.attr('data-overflow-hidden') === 'true' ? 'hidden' : 'visible';\r\n                    stageOuter.css('overflow', overflowSetting);\r\n                    console.log('Applied overflow style: ' + overflowSetting);\r\n                }\r\n            } catch (error) {\r\n                console.error(`Error initializing carousel #${index + 1} (ID: ${carouselId}):`, error);\r\n            }\r\n        });\r\n    }\r\n    \r\n    // Démarrer l'initialisation\r\n    console.log('Starting carousel initialization');\r\n    initCarousel();\r\n    \r\n    // Add a fallback initialization after a delay to ensure everything is loaded\r\n    setTimeout(function() {\r\n        if (document.readyState === 'complete' && typeof jQuery !== 'undefined') {\r\n            console.log('Running fallback initialization check');\r\n            const $ = jQuery;\r\n            const carousels = $('.s4_block_carousel.owl-carousel:not(.owl-loaded)');\r\n            if (carousels.length > 0) {\r\n                console.log('Found ' + carousels.length + ' uninitialized carousel(s), reinitializing');\r\n                initOwlCarousels($);\r\n            }\r\n        }\r\n    }, 1000);\r\n    \r\n    // Set up a periodic check for changes and reinitialize if needed (useful in admin/editor context)\r\n    if (typeof wp !== 'undefined' && wp.data) {\r\n        console.log('WordPress editor detected, setting up periodic checks');\r\n        \r\n        // Check every 2 seconds for changes in editor\r\n        const editorCheckInterval = setInterval(function() {\r\n            if (typeof jQuery !== 'undefined') {\r\n                const $ = jQuery;\r\n                const carousels = $('.s4_block_carousel.owl-carousel');\r\n                \r\n                if (carousels.length > 0) {\r\n                    carousels.each(function() {\r\n                        const $carousel = $(this);\r\n                        if (hasConfigChanged($carousel)) {\r\n                            reinitializeCarousel($, $carousel);\r\n                        }\r\n                    });\r\n                }\r\n            }\r\n        }, 2000);\r\n        \r\n        // Clean up on editor unload to prevent memory leaks\r\n        if (window.addEventListener) {\r\n            window.addEventListener('unload', function() {\r\n                clearInterval(editorCheckInterval);\r\n            });\r\n        }\r\n    }\r\n})();\r\n"],"names":["retryCount","maxRetries","carouselConfigs","console","log","document","readyState","scripts","getElementsByTagName","i","length","src","includes","styleSheets","href","e","reinitializeCarousel","$","$carousel","carouselId","attr","optionsString","options","JSON","parse","error","trigger","removeClass","find","remove","css","owlCarousel","stageOuter","overflowSetting","hasConfigChanged","currentConfig","navStyle","configKey","hasChanged","initCarousel","jQuery","setTimeout","ready","carousels","warn","mainCarousels","fn","scriptPath","script","createElement","onload","initOwlCarousels","onerror","head","appendChild","setupMutationObserver","window","MutationObserver","each","observer","mutations","needsReinit","forEach","mutation","type","attributeName","config","attributes","attributeFilter","observe","index","hasClass","defaultOptions","items","loop","margin","nav","dots","autoplay","autoplayTimeout","autoplayHoverPause","mouseDrag","pullDrag","freeDrag","touchDrag","smartSpeed","responsive","carouselOptions","wp","data","editorCheckInterval","setInterval","addEventListener","clearInterval"],"sourceRoot":""}